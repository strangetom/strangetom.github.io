"use strict";var CacheStatus;(function(a){a[a.None=0]="None",a[a.Update=1]="Update",a[a.Current=2]="Current"})(CacheStatus||(CacheStatus={}));class RecipeCard extends HTMLLIElement{constructor(e){super();const t='<svg xmlns="http://www.w3.org/2000/svg" class="meta-icon" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="#fff" stroke-width="10"/><path stroke="#fff" fill="none" stroke-width="10" d="M50 15v35l25 25"/></svg>',n='<svg xmlns="http://www.w3.org/2000/svg" class="meta-icon" viewBox="0 0 60 90"><g fill="#fff"><path d="M26.814 21.33c0-10.2-6.003-21.3-13.407-21.3C6.002.03 0 11.13 0 21.33c0 6.429 2.387 10.96 6.006 13.433 2.262 1.546 3.647 4.075 3.599 6.814l-.76 43.582c-.042 2.419 1.717 4.6 4.126 4.824a4.568 4.568 0 005.003-4.626l-.764-43.78c-.048-2.739 1.338-5.268 3.599-6.814 3.618-2.474 6.005-7.004 6.005-13.433zM60.983 29.703L60.219.973a1 1 0 00-1-.973h-2.222a1 1 0 00-1 1v24.127a1 1 0 01-1 1h-1.915a1 1 0 01-1-1V1a1 1 0 00-1-1h-2.297a1 1 0 00-1 1v24.127a1 1 0 01-1 1H44.87a1 1 0 01-1-1V1a1 1 0 00-1-1h-2.222a1 1 0 00-1 .973l-.764 28.73a3.999 3.999 0 002.961 3.969l2.14.575a2.998 2.998 0 012.221 2.95l-.84 48.159a4.566 4.566 0 109.132 0l-.84-48.159a3.001 3.001 0 012.221-2.95l2.14-.575a3.998 3.998 0 002.964-3.969z"/></g></svg>',s='<svg xmlns="http://www.w3.org/2000/svg" class="meta-icon" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" fill="#fff"/></svg>',c=document.createElement("h2");c.appendChild(document.createTextNode(e.name)),c.setAttribute("class","recipe-title");const r=document.createElement("img");r.setAttribute("class","recipe-photo"),r.setAttribute("src",e.image),r.setAttribute("alt",e.name),r.setAttribute("width","512"),r.setAttribute("height","288");const i=document.createElement("div");i.classList.add("recipe-overlay"),i.classList.add(e.category),i.appendChild(r),i.appendChild(c);const l=document.createElement("a");if(l.setAttribute("href",e.html),l.appendChild(i),e.image.split(".").pop()=="svg"){const o=document.createElement("span");o.innerHTML="Coming Soon",o.classList.add("recipe-new"),l.appendChild(o)}l.appendChild(this.newLabel(t+`
`+e.time,e.category)),l.appendChild(this.newLabel(n+`
Serves `+e.yield,e.category)),e.nutrition&&l.appendChild(this.newLabel("Nutrition &#10003;",e.category)),e.diet.includes("Vegan")&&l.appendChild(this.newLabel("Vegan",e.category)),e.diet.includes("GlutenFree")&&l.appendChild(this.newLabel("Gluten Free",e.category)),e.diet.includes("DairyFree")&&l.appendChild(this.newLabel("Dairy Free",e.category)),e.diet.includes("NutFree")&&l.appendChild(this.newLabel("Nut Free",e.category));for(let o of e.cuisine)l.appendChild(this.newLabel(s+`
`+o,e.category));this.appendChild(l)}newLabel(e,t){const n=document.createElement("span");return n.innerHTML=e,n.classList.add("recipe-meta"),n.classList.add(t),n}}function restoreState(){if(sessionStorage.getItem("lastSearch")){let a=sessionStorage.getItem("lastSearch");if(a=="name"){let e=sessionStorage.getItem("value"),t=document.getElementById("name-pattern");t.value=e,document.getElementById("name-btn").click(),onPatternChange()}else if(a=="selection"){let e=sessionStorage.getItem("selection"),t=sessionStorage.getItem("value"),n=document.getElementById("select");n.value=t;let s=recipe_data.recipes.filter(c=>c[e].includes(t));document.getElementById("category-btn").click(),displayResults(s)}else if(a=="source"){let e=sessionStorage.getItem("value"),t=document.getElementById("search-source");t.value=e;let n=recipe_data.recipes.filter(s=>s.source.includes(e));document.getElementById("source-btn").click(),displayResults(n)}}}function switchTab(a){let e=a.target,t=document.getElementsByClassName("tab");Array.from(t).forEach(s=>s.classList.add("tab-faded")),e.classList.remove("tab-faded"),document.querySelector("#search-name").classList.add("tab-content-hidden"),document.querySelector("#search-category").classList.add("tab-content-hidden"),document.querySelector("#search-source").classList.add("tab-content-hidden");let n="search-"+e.innerText.toLowerCase();document.getElementById(n).classList.remove("tab-content-hidden")}function toggleRecents(){document.getElementById("slider").classList.toggle("closed")}function clearResultsList(){var a=document.getElementById("search-results"),e=a.cloneNode(!1);a.parentNode.replaceChild(e,a)}function displayResults(a){var e=document.getElementById("search-results"),t=e.cloneNode(!1);for(let s of a){var n=new RecipeCard(s);n.classList.add("search-result"),t.appendChild(n)}e.parentNode.replaceChild(t,e)}function onPatternChange(){sessionStorage.setItem("lastSearch","name");let e=document.getElementById("name-pattern").value;if(sessionStorage.setItem("value",e),e.length==0)clearResultsList();else{let n=index.search(e,30).map(s=>recipe_data.recipes[s]);displayResults(n)}}function sourceSearch(a){let t=a.target.value;if(sessionStorage.setItem("lastSearch","source"),sessionStorage.setItem("value",t),t!=""){var n=recipe_data.recipes.filter(s=>s.source.includes(t));displayResults(n)}else clearResultsList()}function displaySelection(a){let e=a.target,t=e.value,n=e.querySelector("option:checked").parentElement.id.split("-")[0];if(sessionStorage.setItem("lastSearch","selection"),sessionStorage.setItem("selection",n),sessionStorage.setItem("value",t),t!=""){var s=recipe_data.recipes.filter(c=>c[n].includes(t));displayResults(s)}else clearResultsList()}function installServiceWorker(){"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/service-worker.min.js").then(function(){console.log("CLIENT: service worker registration complete.")},function(){console.log("CLIENT: service worker registration failure.")})):console.log("CLIENT: service worker is not supported.")}function cacheSite(a){let e=a.map(t=>[t.html,t.image]).flat();e.push("/js/search_data.min.js"),e.push("/all-recipes"),e.push("/random"),caches.keys().then(t=>t[t.length-1]).then(t=>{caches.open(t).then(n=>{n.addAll(e)})}).then(()=>{let t=document.querySelector("meta[name='update-hash']");localStorage.setItem("last-update-hash",t.content),updateCacheButton()})}function checkOfflineCacheStatus(){let a=localStorage.getItem("last-update-hash");return a==null?CacheStatus.None:document.querySelector("meta[name='update-hash']").content!=a?CacheStatus.Update:CacheStatus.Current}async function updateCacheButton(){let e=(await navigator.storage.estimate()).quota,t=Number(document.querySelector("meta[name='cache-size']").content);if(t>e)return;document.querySelector(".cache-section").classList.remove("hidden");let s=document.querySelector("#update-cache"),c=Math.ceil(t/1e6).toString(),r=checkOfflineCacheStatus();r==CacheStatus.None?s.innerText=`Download for offline access (~${c} MB)`:r==CacheStatus.Update?s.innerText=`Update offline cache (~${c} MB)`:(s.innerText="Offline access ready",s.disabled=!0)}var index=new FlexSearch.Index({tokenize:"forward"});recipe_data.recipes.forEach(({name:a},e)=>{index.add(e,a)}),document.addEventListener("DOMContentLoaded",()=>{installServiceWorker(),customElements.define("recipe-card",RecipeCard,{extends:"li"}),document.getElementById("name-pattern").addEventListener("input",onPatternChange),document.getElementById("recent-btn").addEventListener("click",toggleRecents),document.getElementById("select").addEventListener("change",displaySelection),document.getElementById("search-source").addEventListener("input",sourceSearch);let a=document.getElementsByClassName("tab");Array.from(a).forEach(e=>e.addEventListener("click",switchTab)),restoreState(),updateCacheButton(),document.querySelector("#update-cache").addEventListener("click",e=>{e.preventDefault(),cacheSite(recipe_data.recipes)})});
