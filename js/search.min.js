"use strict";var index=new FlexSearch.Index({tokenize:"forward"});recipe_data.recipes.forEach(({name:t},e)=>{index.add(e,t)}),document.addEventListener("DOMContentLoaded",()=>{installServiceWorker(),customElements.define("recipe-card",RecipeCard,{extends:"a"}),document.querySelector("#sect-category").querySelectorAll(".checkbox > input").forEach(i=>{i.addEventListener("change",displayCategoryFilter)}),document.querySelector("#sect-cuisine").querySelectorAll(".checkbox").forEach(i=>{i.addEventListener("change",displayCuisineFilter)}),document.querySelector("#sect-ingredients").querySelector("#search-ingredients").addEventListener("input",addIngredientToFilter),document.querySelector("#sect-tag").querySelectorAll(".checkbox").forEach(i=>{i.addEventListener("change",displayTagFilter)}),document.querySelector("#sect-name").querySelector("#search-name").addEventListener("input",displayNameFilter),document.querySelector("#sect-source").querySelector("#search-source").addEventListener("input",displaySourceFilter),document.querySelectorAll("input[name='tab']").forEach(i=>{i.addEventListener("change",highlightTab)}),updateCacheButton(),document.querySelector("#cache-site-btn").addEventListener("click",()=>{cacheSite(recipe_data.recipes)});let o=document.querySelector("#theme-btn");o.disabled=!1,o.addEventListener("click",toggleTheme);let u=localStorage.getItem("light-theme");u==null?applyTheme("Auto"):u=="true"?applyTheme("Light"):applyTheme("Dark"),restoreSearch()});class RecipeCard extends HTMLAnchorElement{constructor(e){super();const n='<svg xmlns="http://www.w3.org/2000/svg" class="label-icon" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="var(--fg)" stroke-width="10"/><path stroke="var(--fg)" fill="none" stroke-width="10" d="M50 15v35l25 25"/></svg>',l='<svg xmlns="http://www.w3.org/2000/svg" class="label-icon" viewBox="0 0 60 90"><g fill="var(--fg)"><path d="M26.814 21.33c0-10.2-6.003-21.3-13.407-21.3C6.002.03 0 11.13 0 21.33c0 6.429 2.387 10.96 6.006 13.433 2.262 1.546 3.647 4.075 3.599 6.814l-.76 43.582c-.042 2.419 1.717 4.6 4.126 4.824a4.568 4.568 0 005.003-4.626l-.764-43.78c-.048-2.739 1.338-5.268 3.599-6.814 3.618-2.474 6.005-7.004 6.005-13.433zM60.983 29.703L60.219.973a1 1 0 00-1-.973h-2.222a1 1 0 00-1 1v24.127a1 1 0 01-1 1h-1.915a1 1 0 01-1-1V1a1 1 0 00-1-1h-2.297a1 1 0 00-1 1v24.127a1 1 0 01-1 1H44.87a1 1 0 01-1-1V1a1 1 0 00-1-1h-2.222a1 1 0 00-1 .973l-.764 28.73a3.999 3.999 0 002.961 3.969l2.14.575a2.998 2.998 0 012.221 2.95l-.84 48.159a4.566 4.566 0 109.132 0l-.84-48.159a3.001 3.001 0 012.221-2.95l2.14-.575a3.998 3.998 0 002.964-3.969z"/></g></svg>',r='<svg xmlns="http://www.w3.org/2000/svg" class="label-icon" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>',c=document.createElement("h2");c.style.setProperty("--bg-img",`url('/images/${e.slug}.webp')`),c.innerText=e.name;const a=document.createElement("div");if(a.classList.add("recipe-labels"),c.appendChild(a),a.appendChild(this.newLabel(n+`
`+e.time)),a.appendChild(this.newLabel(l+`
Serves `+e.yield)),e?.positive){let s=document.createElement("span");s.classList.add("recipe-heart"),s.innerHTML=r,c.appendChild(s)}this.href=`/recipes/${e.slug}`,this.classList.add("recipe-card"),this.appendChild(c)}newLabel(e){const n=document.createElement("span");return n.innerHTML=e,n.classList.add("recipe-label"),n}}function installServiceWorker(){"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/service-worker.min.js").then(function(){console.log("CLIENT: service worker registration complete.")},function(){console.log("CLIENT: service worker registration failure.")})):console.log("CLIENT: service worker is not supported.")}function highlightTab(t){let e=t.target.id;document.querySelectorAll("#sect-tabs label").forEach(l=>{l.getAttribute("for")==e?l.classList.add("active"):l.classList.remove("active")})}function displayResults(t,e){let n=e.cloneNode(!1);for(let l of t){let r=new RecipeCard(l);n.appendChild(r)}e.parentNode.replaceChild(n,e)}function clearResults(t){let e=t.cloneNode(!1);t.parentNode.replaceChild(e,t)}function displayCategoryFilter(){let e=[...document.querySelectorAll("#sect-category input[type='checkbox']:checked")].map(n=>n.value);if(storeSearch("#sect-category",e),e.length>0){let n=recipe_data.recipes.filter(l=>e.includes(l.category));displayResults(n,document.querySelector("#result-category"))}else clearResults(document.querySelector("#result-category"))}function displayCuisineFilter(){let e=[...document.querySelectorAll("#sect-cuisine input[type='checkbox']:checked")].map(n=>n.value);if(storeSearch("#sect-cuisine",e),e.length>0){let n=recipe_data.recipes.filter(l=>e.filter(c=>l.cuisine?.includes(c)).length>0);displayResults(n,document.querySelector("#result-cuisine"))}else clearResults(document.querySelector("#result-cuisine"))}function displayTagFilter(){let e=[...document.querySelectorAll("#sect-tag input[type='checkbox']:checked")].map(n=>n.value);if(storeSearch("#sect-tag",e),e.length>0){let n=recipe_data.recipes.filter(l=>e.filter(c=>l.tags?.includes(c)).length>0);displayResults(n,document.querySelector("#result-tag"))}else clearResults(document.querySelector("#result-tag"))}function displayNameFilter(){let t=document.querySelector("#search-name").value;if(storeSearch("#sect-name",[t]),t.length>0){let n=index.search(t,20).map(l=>recipe_data.recipes[l]);displayResults(n,document.querySelector("#result-name"))}else clearResults(document.querySelector("#result-name"))}function displaySourceFilter(){let t=document.querySelector("#search-source").value;if(storeSearch("#sect-source",[t]),t.length>0){var e=recipe_data.recipes.filter(n=>n.source.includes(t));displayResults(e,document.querySelector("#result-source"))}else clearResults(document.querySelector("#result-source"))}function addIngredientToFilter(t){let e=document.querySelector("#search-ingredients");if(t.inputType=="insertReplacementText"||t.inputType==null){let n=document.querySelector("#selected-ingredients"),l=newIngredient(e.value);l.addEventListener("change",r=>{r.preventDefault(),r.target.parentElement.remove(),displayIngredientFilter()}),n.appendChild(l),e.value="",displayIngredientFilter()}}function newIngredient(t){let e=document.querySelector(`#recipe-ingredients > option[value='${t}']`).dataset.fdcId,n=document.createElement("div");n.classList.add("checkbox");let l=document.createElement("input");l.setAttribute("type","checkbox"),l.setAttribute("value",t),l.setAttribute("id",`ingredient-${t}`),l.setAttribute("name",`ingredient-${t}`),l.setAttribute("data-fdc-id",e);let r=document.createElement("label");return r.setAttribute("for",`ingredient-${t}`),r.innerText=t+" \u2715",n.appendChild(l),n.appendChild(r),n}function displayIngredientFilter(){let e=[...document.querySelectorAll("#selected-ingredients input")].map(l=>Number(l.dataset.fdcId));if(e.length>0){var n=recipe_data.recipes.filter(l=>e.filter(c=>l.ingredients.includes(c)).length==e.length);displayResults(n,document.querySelector("#result-ingredients"))}else clearResults(document.querySelector("#result-ingredients"))}var CacheStatus=(l=>(l[l.None=0]="None",l[l.Update=1]="Update",l[l.Current=2]="Current",l))(CacheStatus||{});function checkOfflineCacheStatus(){let t=localStorage.getItem("last-update-hash");return t==null?0:document.querySelector("meta[name='update-hash']").content!=t?1:2}function cacheSite(t){let e=t.map(n=>[`/recipes/${n.slug}`,`/images/${n.slug}.webp`]).flat();e.push("/js/search_data.min.js"),e.push("/all-recipes"),e.push("/top-recipes"),caches.keys().then(n=>n[n.length-1]).then(n=>{caches.open(n).then(l=>{l.addAll(e)})}).then(()=>{let n=document.querySelector("meta[name='update-hash']");localStorage.setItem("last-update-hash",n.content),updateCacheButton()})}async function updateCacheButton(){let e=(await navigator.storage.estimate()).quota,n=Number(document.querySelector("meta[name='cache-size']").content);if(n>e)return;let l=document.querySelector("#cache-site-btn"),r=Math.ceil(n/1e6).toString(),c=checkOfflineCacheStatus();c==0?(l.innerHTML=`Cache site<br><span class="light-text">${r} MB</span>`,l.disabled=!1):c==1?(l.innerHTML=`Update cache<br><span class="light-text">${r} MB</span>`,l.disabled=!1):(l.innerHTML="Available<br>offline",l.disabled=!0)}function toggleTheme(){let t=document.querySelector("#theme-btn .light-text");t.innerText=="Auto"?applyTheme("Dark"):t.innerText=="Dark"?applyTheme("Light"):t.innerText=="Light"&&applyTheme("Auto")}function applyTheme(t){let e=document.querySelector("html"),n=document.querySelector("#theme-btn .light-text");t=="Dark"?(localStorage.setItem("light-theme","false"),e.classList.remove("light-theme"),n.innerText="Dark"):t=="Light"?(localStorage.setItem("light-theme","true"),e.classList.add("light-theme"),n.innerText="Light"):t=="Auto"&&applyAutoTheme()}function applyAutoTheme(){let t=document.querySelector("html"),e=document.querySelector("#theme-btn .light-text");e.innerText="Auto",window.matchMedia("(prefers-color-scheme: light)").matches?(localStorage.removeItem("light-theme"),t.classList.add("light-theme")):(localStorage.removeItem("light-theme"),t.classList.remove("light-theme"))}function storeSearch(t,e){sessionStorage.setItem("search-tabID",t),sessionStorage.setItem("search-values",JSON.stringify(e))}function restoreSearch(){let t=sessionStorage.getItem("search-tabID");if(t==null||t=="")return;let e=JSON.parse(sessionStorage.getItem("search-values"));if(e==null||e.length==0)return;let n=document.querySelector(t),l=n.querySelector("input[type='radio']");if(l.checked=!0,l.dispatchEvent(new InputEvent("change")),t=="#sect-name"||t=="#sect-source"){let r=n.querySelector("input[type='search']");r.value=e[0],r.dispatchEvent(new Event("input"))}else{for(const r of e){let c=n.querySelector(`input[value="${r}"`);c.checked=!0}switch(t){case"#sect-category":displayCategoryFilter();break;case"#sect-cuisine":displayCuisineFilter();break;case"#sect-tag":displayTagFilter();break}}}
