"use strict";var index=new FlexSearch.Index({tokenize:"forward"});recipe_data.recipes.forEach(({name:r},e)=>{index.add(e,r)});var PaneSize=(t=>(t[t.Close=0]="Close",t[t.Minimise=1]="Minimise",t[t.Open=2]="Open",t))(PaneSize||{}),paneState=0;document.addEventListener("DOMContentLoaded",()=>{customElements.define("recipe-card",RecipeCard,{extends:"a"}),document.querySelector("#search form").addEventListener("submit",search),document.querySelector("#close-search-results").addEventListener("click",()=>{paneState==2?setResultsPaneSize(1):setResultsPaneSize(0)}),document.querySelector("#search-results-header h2").addEventListener("click",()=>{paneState==2?setResultsPaneSize(1):setResultsPaneSize(2)}),document.querySelector("#search-box").addEventListener("click",()=>{paneState==2&&setResultsPaneSize(1)}),document.querySelector("#clear-filters").addEventListener("click",()=>{let a=document.querySelectorAll("#search-filters input:checked");for(const i of a)i.checked=!1})});class RecipeCard extends HTMLAnchorElement{constructor(e){super();const s=document.createElement("h3");s.innerText=e.name,s.style.viewTransitionName=`name-${e.slug}`;const t=document.createElement("img");if(t.src=`/images/${e.slug}.webp`,t.addEventListener("error",()=>{t.src="/img/placeholder.webp"}),t.style.viewTransitionName=`photo-${e.slug}`,this.href=`/recipes/${e.slug}`,this.classList.add("search-result"),this.appendChild(t),this.appendChild(s),e.positive){let n=document.createElement("span");n.classList.add("recipe-heart"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"></path></svg>',n.style.viewTransitionName=`heart-${e.slug}`,this.append(n)}}}function search(r){r.preventDefault();let e=[...document.querySelectorAll("#search-filters input:checked")].map(l=>l.value),s=document.querySelector("#search-box").value,t=document.querySelector('input[name="and-or"]:checked').value,n;s===""?n=recipe_data.recipes:n=index.search(s,20).map(c=>recipe_data.recipes[c]);let a=n.filter(l=>{switch(t){case"or":return recipe_matches_any_filter(l,e);case"and":return recipe_matches_all_filters(l,e);default:return!1}}),i=document.querySelector("#search-results-list"),o=i.cloneNode(!1);for(const l of a.slice(0,100)){let c=new RecipeCard(l);o.appendChild(c)}i.parentElement.replaceChild(o,i);let u=document.querySelector("#search-results-filters");e.length>0?u.innerHTML=e.join(`&nbsp;&nbsp;${t.toUpperCase()}&nbsp;&nbsp;`):u.innerHTML="",setResultsPaneSize(2)}function recipe_matches_any_filter(r,e){let s,t;for(const n of e)if([s,t]=n.split("/"),!!r.hasOwnProperty(s)){if(s.endsWith("s")){if(r[s].includes(t))return!0}else if(r[s]===t)return!0}return!1}function recipe_matches_all_filters(r,e){let s,t;for(const n of e){if([s,t]=n.split("/"),!r.hasOwnProperty(s))return!1;if(s.endsWith("s")){if(!r[s].includes(t))return!1}else if(r[s]!==t)return!1}return!0}function setResultsPaneSize(r){let e=document.querySelector("#search-results"),s=e.querySelector("#search-results-header svg");switch(r){case 0:e.style.height="0",e.style.overflowY="",s.classList.remove("rotate"),paneState=0;break;case 1:e.style.height="4rem",e.style.overflowY="hidden",s.classList.remove("rotate"),paneState=1;break;case 2:e.style.height="calc(100svh - 125px)",e.style.overflowY="",s.classList.add("rotate"),paneState=2;break}}
