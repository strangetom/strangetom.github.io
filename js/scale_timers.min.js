"use strict";const fractionMap={0:"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],ounce:[28,"g"],ounces:[28,"g"],lb:[454,"g"],lbs:[454,"g"],pound:[454,"g"],pounds:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class TimerToast extends HTMLDivElement{constructor(e,l){super();this.time=document.createElement("span");this.progress=document.createElement("div");this.notificationEnabled=!1;this.notificationId=Date.now().toString();this.counter=e,this.initial=e,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="100%";const t=document.createElement("div");if(t.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const o=document.createElement("img");o.src="../img/notification-disabled.svg",o.classList.add("timer-icon"),o.alt="Toggle timer notification";const u=document.createElement("button");u.classList.add("timer-btn"),u.addEventListener("click",()=>{this.notificationEnabled?(o.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(m=>{m==="granted"&&(o.src="../img/notification.svg",this.notificationEnabled=!0)}):(o.src="../img/notification.svg",this.notificationEnabled=!0)}),u.appendChild(o),t.appendChild(u)}const a=document.createElement("img");a.src="../img/timer-start.svg",a.classList.add("timer-icon"),a.alt="Start timer";const c=document.createElement("button");c.classList.add("timer-btn"),c.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),a.src="../img/timer-reset.svg"):(this.reset(),a.src="../img/timer-start.svg")}),c.appendChild(a),t.appendChild(c);const r=document.createElement("img");r.src="../img/timer-close.svg",r.classList.add("timer-icon"),r.alt="Delete timer";const s=document.createElement("button");if(s.classList.add("timer-btn"),s.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),s.appendChild(r),t.appendChild(s),this.appendChild(this.time),l!=""){let o=document.createElement("span");o.innerText=l.replace("@",""),o.classList.add("timer-text"),this.appendChild(o)}this.appendChild(this.progress),this.appendChild(t),this.classList.add("timer")}displayTime(){let e=Math.abs(this.counter),l=Math.floor(e/3600),t=Math.floor(e%3600/60),a=Math.floor(e%60),c=l<10?"0"+l:l.toString(),r=t<10?"0"+t:t.toString(),s=a<10?"0"+a:a.toString();this.time.textContent=c+":"+r+":"+s,this.counter<=0&&(this.time.textContent="-"+this.time.textContent)}decrement(){this.counter--,this.displayTime(),this.counter>0?this.progress.style.width=(100*this.counter/this.initial).toFixed(2)+"%":this.counter==0&&(this.progress.style.width="0%",this.classList.add("timer-expired"),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(e=>{let l="/favicon.svg",t="/img/logo.svg",a="Timer expired!",c={url:window.location.href},r={body:a,icon:t,badge:l,data:c,tag:this.notificationId};e.showNotification("Stranger Foods",r)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="100%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(e=>{e.getNotifications({tag:this.notificationId}).then(l=>{for(const t of l)t.close()})})}}function scaleRecipe(n){let i=n.target;highlightButtons(i);let e=document.querySelector(".scale-btns input:checked"),l=Number(e.value.substring(1));e=document.querySelector(".unit-btns input:checked");let t=e.value.toLowerCase();setServings(l);let a=document.querySelectorAll(".scalable");for(var c=0;c<a.length;c++){let r=l,s=a[c];if(s.hasAttribute("data-unit")){if(s.dataset.default=="")continue;let o=s.dataset.defaultunit,u=s.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[t]).includes(o)){let d=convertableUnits[t][o];r*=d[0],s.dataset.unit=d[1]}else u?s.dataset.unit=convertMixedUnit(t,o):s.dataset.unit=s.dataset.defaultunit;let m;if(s.dataset.default.includes("-"))m=scaleRange(s.dataset.default,r);else if(u){let d=Number(s.dataset.default.slice(0,-1));m=formatQuantity(d*r)}else{let d=Number(s.dataset.default);m=formatQuantity(d*r)}setScaledValue(s,m,u)}else{let o=s.nextElementSibling,u=o.dataset.unit;if(Object.keys(convertableUnits[t]).includes(u)){let d=convertableUnits[t][u];r*=d[0],o.innerHTML=d[1]}else o.innerHTML=convertMixedUnit(t,u);let m;if(s.dataset.default.includes("-")){let d=s.dataset.default;m=scaleRange(d,r)}else{let d=Number(s.dataset.default);m=formatQuantity(d*r)}setScaledValue(s,m,!1)}}}function setServings(n){let i=document.getElementById("servings"),e=i.dataset.default;e.includes("-")?i.innerHTML=scaleRange(e,n):i.innerHTML=formatQuantity(Number(e)*n)}function highlightButtons(n){let i=n.parentElement.children;for(const e of i)e.classList.remove("selected");n.classList.add("selected")}function convertMixedUnit(n,i){let e=Object.keys(convertableUnits[n]).join("|"),t=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+e+")(?<extra>.*)","g").exec(i);if(t){let a=convertableUnits[n][t.groups.unit];return formatQuantity(Number(t.groups.quantity)*a[0])+" "+a[1]+t.groups.extra}else return i}function setScaledValue(n,i,e){e&&(i+="x"),"quantity"in n.dataset?n.dataset.quantity=i:n.innerHTML=i}function scaleRange(n,i){let e=n.split("-"),l=Number(e[0])*i,t=Number(e[1])*i;return formatQuantity(l)+"-"+formatQuantity(t)}function formatQuantity(n){if(Number.isInteger(Number(n)))return n.toString();let i=Math.floor(n),e=Number(n%1),t=Object.keys(fractionMap).map(Number).reduce(function(c,r){return Math.abs(r-e)<Math.abs(c-e)?r:c}),a=fractionMap[t];return i==0?a:i.toString()+a}function toggleSubtitutions(n){let i=n.target,e=i.parentElement.querySelector(".substitute-text");e.classList.toggle("hidden"),e.classList.contains("hidden")?i.src="../img/cart-fill.svg":i.src="../img/cart.svg"}function addTimerToast(){let n=Number(this.dataset.time),i=this.dataset.label;document.querySelector("#timers").appendChild(new TimerToast(n,i))}async function toggleWakeLock(){if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen")}catch(n){console.log(`Wakelock failed: ${n.message}`)}else wakelock.release().then(()=>wakelock=null)}function setTheme(){let n=document.querySelector("html"),i=localStorage.getItem("light-theme");(i==null&&window.matchMedia("(prefers-color-scheme: light)").matches||i=="true")&&n.classList.add("light-theme")}function enableShareButton(){let n=document.querySelector("h1").textContent;const i={title:n,text:`${n} on Stranger Foods`,url:location.href};if(navigator.share!==void 0){let e=document.querySelector("#share");e.classList.remove("hidden"),e.addEventListener("click",async()=>{await navigator.share(i)})}}document.addEventListener("DOMContentLoaded",()=>{var n=document.querySelectorAll(".scale-btns input");for(const t of n)t.addEventListener("click",scaleRecipe);var i=document.querySelectorAll(".unit-btns input");for(const t of i)t.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".substitute-icon");for(const t of e)t.addEventListener("click",toggleSubtitutions);customElements.define("timer-toast",TimerToast,{extends:"div"});var l=document.querySelectorAll(".toast-btn");for(const t of l)t.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let t=document.querySelector("#wakelock");t.parentElement.classList.remove("hidden"),t.addEventListener("change",toggleWakeLock)}setTheme(),enableShareButton()});
