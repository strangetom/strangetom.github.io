"use strict";const fractionMap={0:"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],ounce:[28,"g"],ounces:[28,"g"],lb:[454,"g"],lbs:[454,"g"],pound:[454,"g"],pounds:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class TimerToast extends HTMLDivElement{constructor(e,o){super();this.time=document.createElement("span");this.progress=document.createElement("div");this.notificationEnabled=!1;this.notificationId=Date.now().toString();this.counter=e,this.initial=e,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="100%";const s=document.createElement("div");if(s.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const c=document.createElement("img");c.src="../img/notification-disabled.svg",c.classList.add("timer-icon"),c.alt="Toggle timer notification";const u=document.createElement("button");u.classList.add("timer-btn"),u.addEventListener("click",()=>{this.notificationEnabled?(c.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(d=>{d==="granted"&&(c.src="../img/notification.svg",this.notificationEnabled=!0)}):(c.src="../img/notification.svg",this.notificationEnabled=!0)}),u.appendChild(c),s.appendChild(u)}const a=document.createElement("img");a.src="../img/timer-start.svg",a.classList.add("timer-icon"),a.alt="Start timer";const i=document.createElement("button");i.classList.add("timer-btn"),i.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),a.src="../img/timer-reset.svg"):(this.reset(),a.src="../img/timer-start.svg")}),i.appendChild(a),s.appendChild(i);const r=document.createElement("img");r.src="../img/timer-close.svg",r.classList.add("timer-icon"),r.alt="Delete timer";const l=document.createElement("button");l.classList.add("timer-btn"),l.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),l.appendChild(r),s.appendChild(l);const m=document.createElement("div");if(this.appendChild(m),m.appendChild(this.time),o!=""){let c=document.createElement("span");c.innerText=o.replace("@",""),c.classList.add("timer-label"),m.appendChild(c)}this.appendChild(this.progress),this.appendChild(s),this.classList.add("timer")}displayTime(){let e=Math.abs(this.counter),o=Math.floor(e/3600),s=Math.floor(e%3600/60),a=Math.floor(e%60),i=o<10?"0"+o:o.toString(),r=s<10?"0"+s:s.toString(),l=a<10?"0"+a:a.toString();this.time.textContent=i+":"+r+":"+l,this.counter<=0&&(this.time.textContent="-"+this.time.textContent)}decrement(){this.counter--,this.displayTime(),this.counter>0?this.progress.style.width=(100-100*(this.initial-this.counter)/this.initial).toFixed(2)+"%":this.counter==0&&(this.progress.style.width="0%",this.time.classList.add("timer-expired"),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(e=>{let o="/favicon.svg",s="/img/logo.svg",a="Timer expired!",i={url:window.location.href},r={body:a,icon:s,badge:o,data:i,tag:this.notificationId};e.showNotification("Stranger Foods",r)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.time.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="100%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(e=>{e.getNotifications({tag:this.notificationId}).then(o=>{for(const s of o)s.close()})})}}function scaleRecipe(t){let n=t.target;highlightButtons(n);let e=document.querySelector(".scale-controls input:checked"),o=Number(e.value.substring(1));e=document.querySelector(".unit-controls input:checked");let s=e.value.toLowerCase();setServings(o);let a=document.querySelectorAll(".scalable");for(var i=0;i<a.length;i++){let r=o,l=a[i];if(l.hasAttribute("data-unit")){if(l.dataset.default=="")continue;let m=l.dataset.defaultunit,c=l.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[s]).includes(m)){let d=convertableUnits[s][m];r*=d[0],l.dataset.unit=d[1]}else c?l.dataset.unit=convertMixedUnit(s,m):l.dataset.unit=l.dataset.defaultunit;let u;if(l.dataset.default.includes("-"))u=scaleRange(l.dataset.default,r);else if(c){let d=Number(l.dataset.default.slice(0,-1));u=formatQuantity(d*r)}else{let d=Number(l.dataset.default);u=formatQuantity(d*r)}setScaledValue(l,u,c)}else{let m=l.nextElementSibling,c=m.dataset.unit;if(Object.keys(convertableUnits[s]).includes(c)){let d=convertableUnits[s][c];r*=d[0],m.innerHTML=d[1]}else m.innerHTML=convertMixedUnit(s,c);let u;if(l.dataset.default.includes("-")){let d=l.dataset.default;u=scaleRange(d,r)}else{let d=Number(l.dataset.default);u=formatQuantity(d*r)}setScaledValue(l,u,!1)}}}function setServings(t){let n=document.getElementById("servings"),e=n.dataset.default;e.includes("-")?n.innerHTML=scaleRange(e,t):n.innerHTML=formatQuantity(Number(e)*t)}function highlightButtons(t){let n=t.parentElement.children;for(const e of n)e.classList.remove("selected");t.classList.add("selected")}function convertMixedUnit(t,n){let e=Object.keys(convertableUnits[t]).join("|"),s=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+e+")(?<extra>.*)","g").exec(n);if(s){let a=convertableUnits[t][s.groups.unit];return formatQuantity(Number(s.groups.quantity)*a[0])+" "+a[1]+s.groups.extra}else return n}function setScaledValue(t,n,e){e&&(n+="x"),"quantity"in t.dataset?t.dataset.quantity=n:t.innerHTML=n}function scaleRange(t,n){let e=t.split("-"),o=Number(e[0])*n,s=Number(e[1])*n;return formatQuantity(o)+"-"+formatQuantity(s)}function formatQuantity(t){if(Number.isInteger(Number(t)))return t.toString();let n=Math.floor(t),e=Number(t%1),s=Object.keys(fractionMap).map(Number).reduce(function(i,r){return Math.abs(r-e)<Math.abs(i-e)?r:i}),a=fractionMap[s];return n==0?a:n.toString()+a}function addTimerToast(t){let n=Number(this.dataset.time),e=this.dataset.label;t.target.closest("li").appendChild(new TimerToast(n,e))}async function toggleWakeLock(){let t=document.querySelector("#wakelock");if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen"),t.classList.add("active")}catch(n){console.log(`Wakelock failed: ${n.message}`),t.classList.remove("active")}else wakelock.release().then(()=>wakelock=null),t.classList.remove("active")}function setTheme(){let t=document.querySelector("html"),n=localStorage.getItem("light-theme");(n==null&&window.matchMedia("(prefers-color-scheme: light)").matches||n=="true")&&t.classList.add("light-theme")}function enableShareButton(){let t=document.querySelector("[itemprop='name']").textContent;const n={title:t,text:`${t} on Stranger Foods`,url:location.href};if(navigator.share!==void 0){let e=document.querySelector("#share");e.classList.remove("hidden"),e.addEventListener("click",async()=>{await navigator.share(n)})}}function changeTemperatureUnits(t){let n=t.target;highlightButtons(n);let o=document.querySelector(".temp-controls input:checked").value;document.querySelectorAll(".temperature").forEach(a=>{let i=Number(a.dataset.value);o=="F"&&(i=Math.round(i*1.8+32)),a.innerHTML=`<b>${i}</b>&deg;${o}`})}document.addEventListener("DOMContentLoaded",()=>{var t=document.querySelectorAll(".scale-controls input");for(const i of t)i.addEventListener("click",scaleRecipe);var n=document.querySelectorAll(".unit-controls input");for(const i of n)i.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".temp-controls input");for(const i of e)i.addEventListener("click",changeTemperatureUnits);var o=document.querySelectorAll(".substitute-btn");for(const i of o)i.addEventListener("click",r=>{r.target.closest("button").querySelector("span").classList.toggle("hidden")});customElements.define("timer-toast",TimerToast,{extends:"div"});var s=document.querySelectorAll(".toast-btn");for(const i of s)i.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let i=document.querySelector("#wakelock");i.closest("span").classList.remove("hidden"),i.addEventListener("click",toggleWakeLock)}document.querySelector("#show-amounts").classList.remove("hidden"),document.querySelector("#amounts").addEventListener("change",()=>{document.querySelectorAll(".tooltip").forEach(r=>{r.classList.toggle("visible")})}),setTheme(),enableShareButton()});
