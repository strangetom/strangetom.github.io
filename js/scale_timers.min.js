"use strict";const fractionMap={"0":"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],ounce:[28,"g"],ounces:[28,"g"],lb:[454,"g"],lbs:[454,"g"],pound:[454,"g"],pounds:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class TimerToast extends HTMLDivElement{constructor(t,e){super();this.time=document.createElement("span");this.progress=document.createElement("div");this.notificationEnabled=!1;this.notificationId=Date.now().toString();this.counter=t,this.initial=t,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="0%";const l=document.createElement("div");if(l.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const o=document.createElement("img");o.src="../img/notification-disabled.svg",o.classList.add("timer-icon"),o.alt="Toggle timer notification";const c=document.createElement("button");c.classList.add("timer-btn"),c.addEventListener("click",()=>{this.notificationEnabled?(o.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(h=>{h==="granted"&&(o.src="../img/notification.svg",this.notificationEnabled=!0)}):(o.src="../img/notification.svg",this.notificationEnabled=!0)}),c.appendChild(o),l.appendChild(c)}const s=document.createElement("img");s.src="../img/timer-increment.svg",s.classList.add("timer-icon"),s.alt="Add 1 minute to timer";const n=document.createElement("button");n.classList.add("timer-btn"),n.addEventListener("click",()=>{this.increment()}),n.appendChild(s),l.appendChild(n);const r=document.createElement("img");r.src="../img/timer-start.svg",r.classList.add("timer-icon"),r.alt="Start timer";const d=document.createElement("button");d.classList.add("timer-btn"),d.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),r.src="../img/timer-reset.svg"):(this.reset(),r.src="../img/timer-start.svg")}),d.appendChild(r),l.appendChild(d);const a=document.createElement("img");a.src="../img/timer-close.svg",a.classList.add("timer-icon"),a.alt="Delete timer";const u=document.createElement("button");u.classList.add("timer-btn"),u.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),u.appendChild(a),l.appendChild(u);const m=document.createElement("div");if(this.appendChild(m),m.appendChild(this.time),e!=""){let o=document.createElement("span");o.innerText=e.replace("@",""),o.classList.add("timer-label"),m.appendChild(o)}this.appendChild(this.progress),this.appendChild(l),this.classList.add("timer")}displayTime(){let t=Math.abs(this.counter),e=Math.floor(t/3600),l=Math.floor(t%3600/60),s=Math.floor(t%60),n=e<10?"0"+e:e.toString(),r=l<10?"0"+l:l.toString(),d=s<10?"0"+s:s.toString();this.time.textContent=n+":"+r+":"+d,this.counter<=0&&(this.time.textContent="-"+this.time.textContent)}increment(){this.counter+=60,this.initial+=60,this.displayTime()}decrement(){this.counter--,this.displayTime(),this.counter>0?this.progress.style.width=(100*(this.initial-this.counter)/this.initial).toFixed(2)+"%":this.counter==0&&(this.progress.style.width="100%",this.time.classList.add("timer-expired"),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(t=>{let e="/favicon.svg",l="/img/logo.svg",s="Timer expired!",n={url:window.location.href},r={body:s,icon:l,badge:e,data:n,tag:this.notificationId};t.showNotification("Stranger Foods",r)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.time.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="0%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(t=>{t.getNotifications({tag:this.notificationId}).then(e=>{for(const l of e)l.close()})})}}function scaleRecipe(i){let t=i.target;highlightButtons(t);let e=document.querySelector(".scale-btns input:checked"),l=Number(e.value.substring(1));e=document.querySelector(".unit-btns input:checked");let s=e.value.toLowerCase();setServings(l);let n=document.querySelectorAll(".scalable");for(var r=0;r<n.length;r++){let d=l,a=n[r];if(a.hasAttribute("data-unit")){if(a.dataset.default=="")continue;let u=a.dataset.defaultunit,m=a.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[s]).includes(u)){let c=convertableUnits[s][u];d*=c[0],a.dataset.unit=c[1]}else m?a.dataset.unit=convertMixedUnit(s,u):a.dataset.unit=a.dataset.defaultunit;let o;if(a.dataset.default.includes("-"))o=scaleRange(a.dataset.default,d);else if(m){let c=Number(a.dataset.default.slice(0,-1));o=formatQuantity(c*d)}else{let c=Number(a.dataset.default);o=formatQuantity(c*d)}setScaledValue(a,o,m)}else{let u=a.nextElementSibling,m=u.dataset.unit;if(Object.keys(convertableUnits[s]).includes(m)){let c=convertableUnits[s][m];d*=c[0],u.innerHTML=c[1]}else u.innerHTML=convertMixedUnit(s,m);let o;if(a.dataset.default.includes("-")){let c=a.dataset.default;o=scaleRange(c,d)}else{let c=Number(a.dataset.default);o=formatQuantity(c*d)}setScaledValue(a,o,!1)}}}function setServings(i){let t=document.getElementById("servings"),e=t.dataset.default;e.includes("-")?t.innerHTML=scaleRange(e,i):t.innerHTML=formatQuantity(Number(e)*i)}function highlightButtons(i){let t=i.parentElement.children;for(const e of t)e.classList.remove("selected");i.classList.add("selected")}function convertMixedUnit(i,t){let e=Object.keys(convertableUnits[i]).join("|"),s=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+e+")(?<extra>.*)","g").exec(t);if(s){let n=convertableUnits[i][s.groups.unit];return formatQuantity(Number(s.groups.quantity)*n[0])+" "+n[1]+s.groups.extra}else return t}function setScaledValue(i,t,e){e&&(t+="x"),"quantity"in i.dataset?i.dataset.quantity=t:i.innerHTML=t}function scaleRange(i,t){let e=i.split("-"),l=Number(e[0])*t,s=Number(e[1])*t;return formatQuantity(l)+"-"+formatQuantity(s)}function formatQuantity(i){if(Number.isInteger(Number(i)))return i.toString();let t=Math.floor(i),e=Number(i%1),s=Object.keys(fractionMap).map(Number).reduce(function(r,d){return Math.abs(d-e)<Math.abs(r-e)?d:r}),n=fractionMap[s];return t==0?n:t.toString()+n}function toggleSubtitutions(i){let t=i.target,e=t.parentElement.querySelector(".substitute-text");e.classList.toggle("hidden"),e.classList.contains("hidden")?t.src="../img/cart-fill.svg":t.src="../img/cart.svg"}function addTimerToast(i){let t=Number(this.dataset.time),e=this.dataset.label;i.target.closest("li").appendChild(new TimerToast(t,e))}async function toggleWakeLock(){if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen")}catch(i){console.log(`Wakelock failed: ${i.message}`)}else wakelock.release().then(()=>wakelock=null)}function setTheme(){let i=document.querySelector("html"),t=localStorage.getItem("light-theme");(t==null&&window.matchMedia("(prefers-color-scheme: light)").matches||t=="true")&&i.classList.add("light-theme")}function enableShareButton(){let i=document.querySelector("h1").textContent;const t={title:i,text:`${i} on Stranger Foods`,url:location.href};if(navigator.share!==void 0){let e=document.querySelector("#share");e.classList.remove("hidden"),e.addEventListener("click",async()=>{await navigator.share(t)})}}document.addEventListener("DOMContentLoaded",()=>{var i=document.querySelectorAll(".scale-btns input");for(const n of i)n.addEventListener("click",scaleRecipe);var t=document.querySelectorAll(".unit-btns input");for(const n of t)n.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".substitute-icon");for(const n of e)n.addEventListener("click",toggleSubtitutions);customElements.define("timer-toast",TimerToast,{extends:"div"});var l=document.querySelectorAll(".toast-btn");for(const n of l)n.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let n=document.querySelector("#wakelock");n.parentElement.classList.remove("hidden"),n.addEventListener("change",toggleWakeLock)}document.querySelectorAll(".tooltip").forEach(n=>{n.addEventListener("click",r=>{r.preventDefault()})}),setTheme(),enableShareButton()});
