"use strict";const fractionMap={0:"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],ounce:[28,"g"],ounces:[28,"g"],lb:[454,"g"],lbs:[454,"g"],pound:[454,"g"],pounds:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class TimerToast extends HTMLDivElement{constructor(t,r){super();this.time=document.createElement("span");this.progress=document.createElement("div");this.notificationEnabled=!1;this.notificationId=Date.now().toString();this.counter=t,this.initial=t,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="0%";const i=document.createElement("div");if(i.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const o=document.createElement("img");o.src="../img/notification-disabled.svg",o.classList.add("timer-icon"),o.alt="Toggle timer notification";const h=document.createElement("button");h.classList.add("timer-btn"),h.addEventListener("click",()=>{this.notificationEnabled?(o.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(f=>{f==="granted"&&(o.src="../img/notification.svg",this.notificationEnabled=!0)}):(o.src="../img/notification.svg",this.notificationEnabled=!0)}),h.appendChild(o),i.appendChild(h)}const c=document.createElement("img");c.src="../img/timer-increment.svg",c.classList.add("timer-icon"),c.alt="Add 1 minute to timer";const n=document.createElement("button");n.classList.add("timer-btn"),n.addEventListener("click",()=>{this.increment()}),n.appendChild(c),i.appendChild(n);const a=document.createElement("img");a.src="../img/timer-start.svg",a.classList.add("timer-icon"),a.alt="Start timer";const l=document.createElement("button");l.classList.add("timer-btn"),l.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),a.src="../img/timer-reset.svg"):(this.reset(),a.src="../img/timer-start.svg")}),l.appendChild(a),i.appendChild(l);const d=document.createElement("img");d.src="../img/timer-close.svg",d.classList.add("timer-icon"),d.alt="Delete timer";const u=document.createElement("button");u.classList.add("timer-btn"),u.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),u.appendChild(d),i.appendChild(u);const m=document.createElement("div");if(this.appendChild(m),m.appendChild(this.time),r!=""){let o=document.createElement("span");o.innerText=r.replace("@",""),o.classList.add("timer-label"),m.appendChild(o)}this.appendChild(this.progress),this.appendChild(i),this.classList.add("timer")}displayTime(){let t=Math.abs(this.counter),r=Math.floor(t/3600),i=Math.floor(t%3600/60),c=Math.floor(t%60),n=r<10?"0"+r:r.toString(),a=i<10?"0"+i:i.toString(),l=c<10?"0"+c:c.toString();this.time.textContent=n+":"+a+":"+l,this.counter<=0&&(this.time.textContent="-"+this.time.textContent)}increment(){this.counter+=60,this.initial+=60,this.displayTime()}decrement(){this.counter--,this.displayTime(),this.counter>0?this.progress.style.width=(100*(this.initial-this.counter)/this.initial).toFixed(2)+"%":this.counter==0&&(this.progress.style.width="100%",this.time.classList.add("timer-expired"),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(t=>{let r="/favicon.svg",i="/img/logo.svg",c="Timer expired!",n={url:window.location.href},a={body:c,icon:i,badge:r,data:n,tag:this.notificationId};t.showNotification("Stranger Foods",a)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.time.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="0%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(t=>{t.getNotifications({tag:this.notificationId}).then(r=>{for(const i of r)i.close()})})}}function scaleRecipe(e){let s=e.target;highlightButtons(s);let t=document.querySelector(".scale-btns input:checked"),r=Number(t.value.substring(1));t=document.querySelector(".unit-btns input:checked");let i=t.value.toLowerCase();setServings(r);let c=document.querySelectorAll(".scalable");for(var n=0;n<c.length;n++){let a=r,l=c[n];if(l.hasAttribute("data-unit")){if(l.dataset.default=="")continue;let d=l.dataset.defaultunit,u=l.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[i]).includes(d)){let o=convertableUnits[i][d];a*=o[0],l.dataset.unit=o[1]}else u?l.dataset.unit=convertMixedUnit(i,d):l.dataset.unit=l.dataset.defaultunit;let m;if(l.dataset.default.includes("-"))m=scaleRange(l.dataset.default,a);else if(u){let o=Number(l.dataset.default.slice(0,-1));m=formatQuantity(o*a)}else{let o=Number(l.dataset.default);m=formatQuantity(o*a)}setScaledValue(l,m,u)}else{let d=l.nextElementSibling,u=d.dataset.unit;if(Object.keys(convertableUnits[i]).includes(u)){let o=convertableUnits[i][u];a*=o[0],d.innerHTML=o[1]}else d.innerHTML=convertMixedUnit(i,u);let m;if(l.dataset.default.includes("-")){let o=l.dataset.default;m=scaleRange(o,a)}else{let o=Number(l.dataset.default);m=formatQuantity(o*a)}setScaledValue(l,m,!1)}}}function setServings(e){let s=document.getElementById("servings"),t=s.dataset.default;t.includes("-")?s.innerHTML=scaleRange(t,e):s.innerHTML=formatQuantity(Number(t)*e)}function highlightButtons(e){let s=e.parentElement.children;for(const t of s)t.classList.remove("selected");e.classList.add("selected")}function convertMixedUnit(e,s){let t=Object.keys(convertableUnits[e]).join("|"),i=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+t+")(?<extra>.*)","g").exec(s);if(i){let c=convertableUnits[e][i.groups.unit];return formatQuantity(Number(i.groups.quantity)*c[0])+" "+c[1]+i.groups.extra}else return s}function setScaledValue(e,s,t){t&&(s+="x"),"quantity"in e.dataset?e.dataset.quantity=s:e.innerHTML=s}function scaleRange(e,s){let t=e.split("-"),r=Number(t[0])*s,i=Number(t[1])*s;return formatQuantity(r)+"-"+formatQuantity(i)}function formatQuantity(e){if(Number.isInteger(Number(e)))return e.toString();let s=Math.floor(e),t=Number(e%1),i=Object.keys(fractionMap).map(Number).reduce(function(n,a){return Math.abs(a-t)<Math.abs(n-t)?a:n}),c=fractionMap[i];return s==0?c:s.toString()+c}function addTimerToast(e){let s=Number(this.dataset.time),t=this.dataset.label;e.target.closest("li").appendChild(new TimerToast(s,t))}async function toggleWakeLock(){if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen")}catch(e){console.log(`Wakelock failed: ${e.message}`)}else wakelock.release().then(()=>wakelock=null)}function setTheme(){let e=document.querySelector("html"),s=localStorage.getItem("light-theme");(s==null&&window.matchMedia("(prefers-color-scheme: light)").matches||s=="true")&&e.classList.add("light-theme")}function enableShareButton(){let e=document.querySelector("h1").textContent;const s={title:e,text:`${e} on Stranger Foods`,url:location.href};if(navigator.share!==void 0){let t=document.querySelector("#share");t.classList.remove("hidden"),t.addEventListener("click",async()=>{await navigator.share(s)})}}function changeTemperatureUnits(e){let s=e.target;highlightButtons(s);let r=document.querySelector(".temp-btns input:checked").value;document.querySelectorAll(".temperature").forEach(c=>{let n=Number(c.dataset.value);r=="F"&&(n=Math.round(n*1.8+32)),c.innerHTML=`<b>${n}</b>&deg;${r}`})}document.addEventListener("DOMContentLoaded",()=>{var e=document.querySelectorAll(".scale-btns input");for(const n of e)n.addEventListener("click",scaleRecipe);var s=document.querySelectorAll(".unit-btns input");for(const n of s)n.addEventListener("click",scaleRecipe);var t=document.querySelectorAll(".temp-btns input");for(const n of t)n.addEventListener("click",changeTemperatureUnits);var r=document.querySelectorAll(".substitute-btn");for(const n of r)n.addEventListener("click",a=>{a.target.closest("button").querySelector("span").classList.toggle("hidden")});customElements.define("timer-toast",TimerToast,{extends:"div"});var i=document.querySelectorAll(".toast-btn");for(const n of i)n.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let n=document.querySelector("#wakelock");n.closest("span").classList.remove("hidden"),n.addEventListener("change",toggleWakeLock)}document.querySelector("#show-amounts").classList.remove("hidden"),document.querySelector("#amounts").addEventListener("change",()=>{document.querySelectorAll(".tooltip").forEach(a=>{a.classList.toggle("visible")})}),setTheme(),enableShareButton()});
