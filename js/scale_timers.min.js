"use strict";var fractionMap={0:"",.5:"½",.333:"⅓",.666:"⅔",.25:"¼",.75:"¾",.2:"⅕",.4:"⅖",.6:"⅗",.8:"⅘",.1665:"⅙",.833:"⅚",.14285:"⅐",.125:"⅛",.375:"⅜",.625:"⅝",.875:"⅞"},convertableUnits={metric:{oz:[28,"g"],lb:[454,"g"],lbs:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}},wakelock=null;class TimerToast extends HTMLDivElement{constructor(t){super(),this.time=document.createElement("span"),this.progress=document.createElement("div"),this.notificationEnabled=!1,this.notificationId=Date.now().toString(),this.counter=t,this.initial=t,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="100%";const e=document.createElement("div");if(e.classList.add("timer-btns"),window.Notification&&"denied"!==Notification.permission){const t=document.createElement("img");t.src="../img/notification-disabled.svg",t.classList.add("timer-icon"),t.alt="Toggle timer notification";const i=document.createElement("button");i.classList.add("timer-btn"),i.addEventListener("click",(()=>{this.notificationEnabled?(t.src="../img/notification-disabled.svg",this.notificationEnabled=!1):"default"===Notification.permission?Notification.requestPermission().then((e=>{"granted"===e&&(t.src="../img/notification.svg",this.notificationEnabled=!0)})):(t.src="../img/notification.svg",this.notificationEnabled=!0)})),i.appendChild(t),e.appendChild(i)}const i=document.createElement("img");i.src="../img/timer-start.svg",i.classList.add("timer-icon"),i.alt="Start timer";const n=document.createElement("button");n.classList.add("timer-btn"),n.addEventListener("click",(()=>{null==this.interval?(this.interval=setInterval(this.decrement.bind(this),1e3),i.src="../img/timer-reset.svg"):(this.reset(),i.src="../img/timer-start.svg")})),n.appendChild(i),e.appendChild(n);const s=document.createElement("img");s.src="../img/timer-close.svg",s.classList.add("timer-icon"),s.alt="Delete timer";const a=document.createElement("button");a.classList.add("timer-btn"),a.addEventListener("click",(()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",(()=>{this.parentNode.removeChild(this)}))})),a.appendChild(s),e.appendChild(a),this.appendChild(this.time),this.appendChild(this.progress),this.appendChild(e),this.classList.add("timer")}displayTime(){let t=Math.floor(this.counter/3600),e=Math.floor(this.counter%3600/60),i=Math.floor(this.counter%60),n=t<10?"0"+t:t.toString(),s=e<10?"0"+e:e.toString(),a=i<10?"0"+i:i.toString();this.time.textContent=n+":"+s+":"+a}decrement(){this.counter>0?(this.counter--,this.displayTime(),this.progress.style.width=(100*this.counter/this.initial).toFixed(2)+"%"):(this.classList.add("timer-expired"),clearInterval(this.interval),this.notificationEnabled&&"granted"===Notification.permission&&navigator.serviceWorker.ready.then((t=>{let e={body:"Timer expired!",icon:"/img/logo.svg",badge:"/favicon.svg",data:{url:window.location.href},tag:this.notificationId};t.showNotification("Stranger Foods",e)})))}reset(){null!=this.interval&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="100%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then((t=>{t.getNotifications({tag:this.notificationId}).then((t=>{for(const e of t)e.close()}))}))}}function scaleRecipe(t){highlightButtons(t.target);let e=document.querySelector(".scale-btns > .selected"),i=Number(e.innerHTML.substring(1));e=document.querySelector(".unit-btns > .selected");let n=e.innerHTML.toLowerCase();setServings(i);let s=document.querySelectorAll(".scalable");for(var a=0;a<s.length;a++){let t=i,e=s[a];if(e.hasAttribute("data-unit")){if(""==e.dataset.default)continue;let i,s=e.dataset.defaultunit,a="x"==e.dataset.default.slice(-1);if(Object.keys(convertableUnits[n]).includes(s)){let i=convertableUnits[n][s];t*=i[0],e.dataset.unit=i[1]}else e.dataset.unit=a?convertMixedUnit(n,s):e.dataset.defaultunit;if(e.dataset.default.includes("-"))i=scaleRange(e.dataset.default,t);else if(a){i=formatQuantity(Number(e.dataset.default.slice(0,-1))*t)}else{i=formatQuantity(Number(e.dataset.default)*t)}setScaledValue(e,i,a)}else{let i,s=e.nextElementSibling,a=s.dataset.unit;if(Object.keys(convertableUnits[n]).includes(a)){let e=convertableUnits[n][a];t*=e[0],s.innerHTML=e[1]}else s.innerHTML=convertMixedUnit(n,a);if(e.dataset.default.includes("-")){e.dataset.default;i=scaleRange(e.dataset.default,t)}else{i=formatQuantity(Number(e.dataset.default)*t)}setScaledValue(e,i,!1)}}}function setServings(t){let e=document.getElementById("servings"),i=e.dataset.default;i.includes("-")?e.innerHTML=scaleRange(i,t):e.innerHTML=formatQuantity(Number(i)*t)}function highlightButtons(t){let e=t.parentElement.children;for(const t of e)t.classList.remove("selected");t.classList.add("selected")}function convertMixedUnit(t,e){let i=Object.keys(convertableUnits[t]).join("|"),n=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+i+")(?<extra>.*)","g").exec(e);if(n){let e=convertableUnits[t][n.groups.unit];return formatQuantity(Number(n.groups.quantity)*e[0])+" "+e[1]+n.groups.extra}return e}function setScaledValue(t,e,i){i&&(e+="x"),"quantity"in t.dataset?t.dataset.quantity=e:t.innerHTML=e}function scaleRange(t,e){let i=t.split("-"),n=Number(i[0])*e,s=Number(i[1])*e;return formatQuantity(n)+"-"+formatQuantity(s)}function formatQuantity(t){if(Number.isInteger(Number(t)))return t.toString();let e=Math.floor(t),i=Number(t%1),n=Object.keys(fractionMap).map(Number).reduce((function(t,e){return Math.abs(e-i)<Math.abs(t-i)?e:t})),s=fractionMap[n];return 0==e?s:e.toString()+s}function toggleSubtitutions(t){let e=t.target,i=e.parentElement.querySelector(".substitute-text");i.classList.toggle("hidden"),i.classList.contains("hidden")?e.src="../img/cart-fill.svg":e.src="../img/cart.svg"}function addTimerToast(){let t=Number(this.dataset.time);document.querySelector("#timers").appendChild(new TimerToast(t))}async function toggleWakeLock(){if(null==wakelock)try{wakelock=await navigator.wakeLock.request("screen")}catch(t){console.log(`Wakelock failed: ${t.message}`)}else wakelock.release().then((()=>wakelock=null))}document.addEventListener("DOMContentLoaded",(()=>{var t=document.querySelectorAll(".scale-btns > button");for(const e of t)e.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".unit-btns > button");for(const t of e)t.addEventListener("click",scaleRecipe);var i=document.querySelectorAll(".substitute-icon");for(const t of i)t.addEventListener("click",toggleSubtitutions);customElements.define("timer-toast",TimerToast,{extends:"div"});var n=document.querySelectorAll(".toast-btn");for(const t of n)t.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let t=document.querySelector("#wakelock");t.parentElement.classList.remove("hidden"),t.addEventListener("change",toggleWakeLock)}}));