var fractionMap={0:"",.5:"½",.333:"⅓",.666:"⅔",.25:"¼",.75:"¾",.2:"⅕",.4:"⅖",.6:"⅗",.8:"⅘",.1665:"⅙",.833:"⅚",.14285:"⅐",.125:"⅛",.375:"⅜",.625:"⅝",.875:"⅞"},convertableUnits={metric:{oz:[28,"g"],lb:[454,"g"],lbs:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};function scaleRecipe(t){highlightButtons(t.target);let e=document.querySelector(".scale-btns > .selected"),n=Number(e.innerHTML.substring(1));e=document.querySelector(".unit-btns > .selected");let a=e.innerHTML.toLowerCase();setServings(n);let r=document.querySelectorAll(".scalable");for(var s=0;s<r.length;s++){let t=n,e=r[s];if(e.hasAttribute("data-unit")){if(""==e.dataset.default)continue;let n,r=e.dataset.defaultunit,s="x"==e.dataset.default.slice(-1);if(Object.keys(convertableUnits[a]).includes(r)){let n=convertableUnits[a][r];t*=n[0],e.dataset.unit=n[1]}else e.dataset.unit=s?convertMixedUnit(a,r):e.dataset.defaultunit;if(e.dataset.default.includes("-"))n=scaleRange(e.dataset.default,t);else if(s){n=formatQuantity(Number(e.dataset.default.slice(0,-1))*t)}else{n=formatQuantity(Number(e.dataset.default)*t)}setScaledValue(e,n,s)}else{let n,r=e.nextElementSibling,s=r.dataset.unit;if(Object.keys(convertableUnits[a]).includes(s)){let e=convertableUnits[a][s];t*=e[0],r.innerHTML=e[1]}else r.innerHTML=convertMixedUnit(a,s);if(e.dataset.default.includes("-")){e.dataset.default;n=scaleRange(e.dataset.default,t)}else{n=formatQuantity(Number(e.dataset.default)*t)}setScaledValue(e,n,!1)}}}function setServings(t){let e=document.getElementById("servings"),n=e.dataset.default;n.includes("-")?e.innerHTML=scaleRange(n,t):e.innerHTML=formatQuantity(Number(n)*t)}function highlightButtons(t){let e=t.parentElement.children;for(const t of e)t.classList.remove("selected");t.classList.add("selected")}function convertMixedUnit(t,e){let n=Object.keys(convertableUnits[t]).join("|"),a=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+n+")(?<extra>.*)","g").exec(e);if(a){let e=convertableUnits[t][a.groups.unit];return formatQuantity(Number(a.groups.quantity)*e[0])+" "+e[1]+a.groups.extra}return e}function setScaledValue(t,e,n){n&&(e+="x"),"quantity"in t.dataset?t.dataset.quantity=e:t.innerHTML=e}function scaleRange(t,e){let n=t.split("-"),a=Number(n[0])*e,r=Number(n[1])*e;return formatQuantity(a)+"-"+formatQuantity(r)}function formatQuantity(t){if(Number.isInteger(Number(t)))return t.toString();let e=Math.floor(t),n=Number(t%1),a=Object.keys(fractionMap).map(Number).reduce((function(t,e){return Math.abs(e-n)<Math.abs(t-n)?e:t})),r=fractionMap[a];return 0==e?r:e.toString()+r}function toggleSubtitutions(t){let e=t.target,n=e.parentElement.querySelector(".substitute-text");n.classList.toggle("hidden"),n.classList.contains("hidden")?e.src="../img/cart-fill.svg":e.src="../img/cart.svg"}document.addEventListener("DOMContentLoaded",(()=>{var t=document.querySelectorAll(".scale-btns > button");for(const e of t)e.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".unit-btns > button");for(const t of e)t.addEventListener("click",scaleRecipe);var n=document.querySelectorAll(".substitute-icon");for(const t of n)t.addEventListener("click",toggleSubtitutions);var a=document.querySelectorAll(".timer-wrapper"),r=Array(),s=Array(),l=Array();for(let t=0;t<a.length;t++){let e=a[t],n=e.querySelector(".timer-display");r[t]=Number(n.dataset.time),s[t]=n;let c=e.querySelector(".timer-btn");c.addEventListener("click",(()=>{c.classList.contains("timer-start")?(l[t]=setInterval(i,1e3,t),s[t].parentElement.parentElement.classList.add("timer-running"),c.classList.remove("timer-start"),c.classList.add("timer-reset")):(clearInterval(l[t]),r[t]=n.dataset.time,i(t),s[t].parentElement.parentElement.classList.remove("timer-running"),s[t].parentElement.parentElement.classList.remove("timer-complete"),c.classList.remove("timer-reset"),c.classList.add("timer-start"))})),i(t)}function i(t){let e=Math.floor(r[t]/3600),n=Math.floor(r[t]%3600/60),a=Math.floor(r[t]%60),i=e<10?"0"+e:e.toString(),c=n<10?"0"+n:n.toString(),u=a<10?"0"+a:a.toString();s[t].textContent=i+":"+c+":"+u,r[t]>0?r[t]--:(s[t].parentElement.parentElement.classList.add("timer-complete"),clearInterval(l[t]))}}));