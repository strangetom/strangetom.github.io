"use strict";const fractionMap={0:"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],lb:[454,"g"],lbs:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class TimerToast extends HTMLDivElement{constructor(e){super(),this.time=document.createElement("span"),this.progress=document.createElement("div"),this.notificationEnabled=!1,this.notificationId=Date.now().toString(),this.counter=e,this.initial=e,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="100%";const t=document.createElement("div");if(t.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const l=document.createElement("img");l.src="../img/notification-disabled.svg",l.classList.add("timer-icon"),l.alt="Toggle timer notification";const s=document.createElement("button");s.classList.add("timer-btn"),s.addEventListener("click",()=>{this.notificationEnabled?(l.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(d=>{d==="granted"&&(l.src="../img/notification.svg",this.notificationEnabled=!0)}):(l.src="../img/notification.svg",this.notificationEnabled=!0)}),s.appendChild(l),t.appendChild(s)}const a=document.createElement("img");a.src="../img/timer-start.svg",a.classList.add("timer-icon"),a.alt="Start timer";const i=document.createElement("button");i.classList.add("timer-btn"),i.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),a.src="../img/timer-reset.svg"):(this.reset(),a.src="../img/timer-start.svg")}),i.appendChild(a),t.appendChild(i);const o=document.createElement("img");o.src="../img/timer-close.svg",o.classList.add("timer-icon"),o.alt="Delete timer";const r=document.createElement("button");r.classList.add("timer-btn"),r.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),r.appendChild(o),t.appendChild(r),this.appendChild(this.time),this.appendChild(this.progress),this.appendChild(t),this.classList.add("timer")}displayTime(){let e=Math.floor(this.counter/3600),t=Math.floor(this.counter%3600/60),a=Math.floor(this.counter%60),i=e<10?"0"+e:e.toString(),o=t<10?"0"+t:t.toString(),r=a<10?"0"+a:a.toString();this.time.textContent=i+":"+o+":"+r}decrement(){this.counter>0?(this.counter--,this.displayTime(),this.progress.style.width=(100*this.counter/this.initial).toFixed(2)+"%"):(this.classList.add("timer-expired"),clearInterval(this.interval),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(e=>{let t="/favicon.svg",a="/img/logo.svg",i="Timer expired!",o={url:window.location.href},r={body:i,icon:a,badge:t,data:o,tag:this.notificationId};e.showNotification("Stranger Foods",r)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="100%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(e=>{e.getNotifications({tag:this.notificationId}).then(t=>{for(const a of t)a.close()})})}}function scaleRecipe(n){let e=n.target;highlightButtons(e);let t=document.querySelector(".scale-btns > .selected"),a=Number(t.innerHTML.substring(1));t=document.querySelector(".unit-btns > .selected");let i=t.innerHTML.toLowerCase();setServings(a);let o=document.querySelectorAll(".scalable");for(var r=0;r<o.length;r++){let l=a,s=o[r];if(s.hasAttribute("data-unit")){if(s.dataset.default=="")continue;let d=s.dataset.defaultunit,m=s.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[i]).includes(d)){let c=convertableUnits[i][d];l*=c[0],s.dataset.unit=c[1]}else m?s.dataset.unit=convertMixedUnit(i,d):s.dataset.unit=s.dataset.defaultunit;let u;if(s.dataset.default.includes("-"))u=scaleRange(s.dataset.default,l);else if(m){let c=Number(s.dataset.default.slice(0,-1));u=formatQuantity(c*l)}else{let c=Number(s.dataset.default);u=formatQuantity(c*l)}setScaledValue(s,u,m)}else{let d=s.nextElementSibling,m=d.dataset.unit;if(Object.keys(convertableUnits[i]).includes(m)){let c=convertableUnits[i][m];l*=c[0],d.innerHTML=c[1]}else d.innerHTML=convertMixedUnit(i,m);let u;if(s.dataset.default.includes("-")){let c=s.dataset.default;u=scaleRange(s.dataset.default,l)}else{let c=Number(s.dataset.default);u=formatQuantity(c*l)}setScaledValue(s,u,!1)}}}function setServings(n){let e=document.getElementById("servings"),t=e.dataset.default;t.includes("-")?e.innerHTML=scaleRange(t,n):e.innerHTML=formatQuantity(Number(t)*n)}function highlightButtons(n){let e=n.parentElement.children;for(const t of e)t.classList.remove("selected");n.classList.add("selected")}function convertMixedUnit(n,e){let t=Object.keys(convertableUnits[n]).join("|"),i=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+t+")(?<extra>.*)","g").exec(e);if(i){let o=convertableUnits[n][i.groups.unit];return formatQuantity(Number(i.groups.quantity)*o[0])+" "+o[1]+i.groups.extra}else return e}function setScaledValue(n,e,t){t&&(e+="x"),"quantity"in n.dataset?n.dataset.quantity=e:n.innerHTML=e}function scaleRange(n,e){let t=n.split("-"),a=Number(t[0])*e,i=Number(t[1])*e;return formatQuantity(a)+"-"+formatQuantity(i)}function formatQuantity(n){if(Number.isInteger(Number(n)))return n.toString();let e=Math.floor(n),t=Number(n%1),i=Object.keys(fractionMap).map(Number).reduce(function(r,l){return Math.abs(l-t)<Math.abs(r-t)?l:r}),o=fractionMap[i];return e==0?o:e.toString()+o}function toggleSubtitutions(n){let e=n.target,t=e.parentElement.querySelector(".substitute-text");t.classList.toggle("hidden"),t.classList.contains("hidden")?e.src="../img/cart-fill.svg":e.src="../img/cart.svg"}function addTimerToast(){let n=Number(this.dataset.time);document.querySelector("#timers").appendChild(new TimerToast(n))}async function toggleWakeLock(){if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen")}catch(n){console.log(`Wakelock failed: ${n.message}`)}else wakelock.release().then(()=>wakelock=null)}document.addEventListener("DOMContentLoaded",()=>{var n=document.querySelectorAll(".scale-btns > button");for(const i of n)i.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".unit-btns > button");for(const i of e)i.addEventListener("click",scaleRecipe);var t=document.querySelectorAll(".substitute-icon");for(const i of t)i.addEventListener("click",toggleSubtitutions);customElements.define("timer-toast",TimerToast,{extends:"div"});var a=document.querySelectorAll(".toast-btn");for(const i of a)i.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let i=document.querySelector("#wakelock");i.parentElement.classList.remove("hidden"),i.addEventListener("change",toggleWakeLock)}});
