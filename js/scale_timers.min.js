"use strict";const fractionMap={0:"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],ounce:[28,"g"],ounces:[28,"g"],lb:[454,"g"],lbs:[454,"g"],pound:[454,"g"],pounds:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class BackgroundTimer{constructor(e,t={}){this.interval=e;typeof t=="function"?t={finishCallback:t}:(t.finishCallback||=()=>{},(t.tickInterval||t.tickCallback)&&this.enableTicking(t.tickInterval||1e3,t.tickCallback||(()=>{}))),this.options=t}start(){return this.expirationDate=Date.now()+this.interval,this.running=!0,this.tickingEnabled&&this.startTicking(),this.timerID=setTimeout(()=>(this.cancel(),this.options.finishCallback(0,this.formatTime(0))),this.interval),document.addEventListener("resume",()=>this.wakeup(),!1),!0}getRemaining(){return this.expirationDate-Date.now()}wakeup(){var e;if(this.running)if(e=this.getRemaining(),this.cancel(),e>0){this.interval=e;const t=this.start();return this.startTicking(),t}else return this.options.finishCallback(0,this.formatTime(0)),this.cancel}enableTicking(e,t){return this.tickInterval=e,this.tickCallback=t,this.tickingEnabled=!0}pauseTicking(){if(this.tickerID)return clearInterval(this.tickerID),this.tickerID=null}resumeTicking(){return this.startTicking()}roundTime(e){return Math.floor((e+100)/1e3)*1e3}formatTime(e){e/=1e3;let t=parseInt(String(e/3600)),l=t<10?"0"+t:t,s=parseInt(String(e/60)),a=s<10?"0"+s:s,n=parseInt(String(e%60)),o=n<10?"0"+n:n;return l+":"+a+":"+o}startTicking(){if(this.tickingEnabled){const e=()=>{const t=this.roundTime(this.getRemaining());return this.tickCallback(this.formatTime(t),t)};return e(),this.tickerID=setInterval(e,this.tickInterval)}}disableTicking(){if(this.tickerID)return this.tickingEnabled=!1,clearInterval(this.tickerID),this.tickerID=null}addTime(e){return this.expirationDate+=e,this.wakeup()}cancel(){if(this.running)return this.running=!1,this.pauseTicking(),clearTimeout(this.timerID),this.timerID=null}}class TimerToast extends HTMLDivElement{constructor(t,l){super();this.time=document.createElement("span");this.progress=document.createElement("div");this.notificationEnabled=!1;this.notificationId=Date.now().toString();this.counter=t,this.initial=t,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="100%";const s=document.createElement("div");if(s.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const c=document.createElement("img");c.src="../img/notification-disabled.svg",c.classList.add("timer-icon"),c.alt="Toggle timer notification";const d=document.createElement("button");d.classList.add("timer-btn"),d.addEventListener("click",()=>{this.notificationEnabled?(c.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(u=>{u==="granted"&&(c.src="../img/notification.svg",this.notificationEnabled=!0)}):(c.src="../img/notification.svg",this.notificationEnabled=!0)}),d.appendChild(c),s.appendChild(d)}const a=document.createElement("img");a.src="../img/timer-start.svg",a.classList.add("timer-icon"),a.alt="Start timer";const n=document.createElement("button");n.classList.add("timer-btn"),n.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),a.src="../img/timer-reset.svg"):(this.reset(),a.src="../img/timer-start.svg")}),n.appendChild(a),s.appendChild(n);const o=document.createElement("img");o.src="../img/timer-close.svg",o.classList.add("timer-icon"),o.alt="Delete timer";const r=document.createElement("button");r.classList.add("timer-btn"),r.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),r.appendChild(o),s.appendChild(r);const m=document.createElement("div");if(this.appendChild(m),m.appendChild(this.time),l!=""){let c=document.createElement("span");c.innerText=l.replace("@",""),c.classList.add("timer-label"),m.appendChild(c)}this.appendChild(this.progress),this.appendChild(s),this.classList.add("timer")}displayTime(){let t=Math.abs(this.counter),l=Math.floor(t/3600),s=Math.floor(t%3600/60),a=Math.floor(t%60),n=l<10?"0"+l:l.toString(),o=s<10?"0"+s:s.toString(),r=a<10?"0"+a:a.toString();this.time.textContent=n+":"+o+":"+r,this.counter<=0&&(this.time.textContent="-"+this.time.textContent)}decrement(){this.counter--,this.displayTime(),this.counter>0?this.progress.style.width=(100-100*(this.initial-this.counter)/this.initial).toFixed(2)+"%":this.counter==0&&(this.progress.style.width="0%",this.time.classList.add("timer-expired"),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(t=>{let l="/favicon.svg",s="/img/logo.svg",a="Timer expired!",n={url:window.location.href},o={body:a,icon:s,badge:l,data:n,tag:this.notificationId};t.showNotification("Stranger Foods",o)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.time.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="100%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(t=>{t.getNotifications({tag:this.notificationId}).then(l=>{for(const s of l)s.close()})})}}function scaleRecipe(i){let e=i.target;highlightButtons(e);let t=document.querySelector(".scale-controls input:checked"),l=Number(t.value.substring(1));t=document.querySelector(".unit-controls input:checked");let s=t.value.toLowerCase();setServings(l);let a=document.querySelectorAll(".scalable");for(var n=0;n<a.length;n++){let o=l,r=a[n];if(r.hasAttribute("data-unit")){if(r.dataset.default=="")continue;let m=r.dataset.defaultunit,c=r.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[s]).includes(m)){let u=convertableUnits[s][m];o*=u[0],r.dataset.unit=u[1]}else c?r.dataset.unit=convertMixedUnit(s,m):r.dataset.unit=r.dataset.defaultunit;let d;if(r.dataset.default.includes("-"))d=scaleRange(r.dataset.default,o);else if(c){let u=Number(r.dataset.default.slice(0,-1));d=formatQuantity(u*o)}else{let u=Number(r.dataset.default);d=formatQuantity(u*o)}setScaledValue(r,d,c)}else{let m=r.nextElementSibling,c=m.dataset.unit;if(Object.keys(convertableUnits[s]).includes(c)){let u=convertableUnits[s][c];o*=u[0],m.innerHTML=u[1]}else m.innerHTML=convertMixedUnit(s,c);let d;if(r.dataset.default.includes("-")){let u=r.dataset.default;d=scaleRange(u,o)}else{let u=Number(r.dataset.default);d=formatQuantity(u*o)}setScaledValue(r,d,!1)}}}function setServings(i){let e=document.getElementById("servings"),t=e.dataset.default;t.includes("-")?e.innerHTML=scaleRange(t,i):e.innerHTML=formatQuantity(Number(t)*i)}function highlightButtons(i){let e=i.parentElement.children;for(const t of e)t.classList.remove("selected");i.classList.add("selected")}function convertMixedUnit(i,e){let t=Object.keys(convertableUnits[i]).join("|"),s=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+t+")(?<extra>.*)","g").exec(e);if(s){let a=convertableUnits[i][s.groups.unit];return formatQuantity(Number(s.groups.quantity)*a[0])+" "+a[1]+s.groups.extra}else return e}function setScaledValue(i,e,t){t&&(e+="x"),"quantity"in i.dataset?i.dataset.quantity=e:i.innerHTML=e}function scaleRange(i,e){let t=i.split("-"),l=Number(t[0])*e,s=Number(t[1])*e;return formatQuantity(l)+"-"+formatQuantity(s)}function formatQuantity(i){if(Number.isInteger(Number(i)))return i.toString();let e=Math.floor(i),t=Number(i%1),s=Object.keys(fractionMap).map(Number).reduce(function(n,o){return Math.abs(o-t)<Math.abs(n-t)?o:n}),a=fractionMap[s];return e==0?a:e.toString()+a}function addTimerToast(i){let e=Number(this.dataset.time),t=this.dataset.label;i.target.closest("li").appendChild(new TimerToast(e,t))}async function toggleWakeLock(){let i=document.querySelector("#wakelock");if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen"),i.classList.add("active")}catch(e){console.log(`Wakelock failed: ${e.message}`),i.classList.remove("active")}else wakelock.release().then(()=>wakelock=null),i.classList.remove("active")}function setTheme(){let i=document.querySelector("html"),e=localStorage.getItem("light-theme");(e==null&&window.matchMedia("(prefers-color-scheme: light)").matches||e=="true")&&i.classList.add("light-theme")}function enableShareButton(){let i=document.querySelector("[itemprop='name']").textContent;const e={title:i,text:`${i} on Stranger Foods`,url:location.href};if(navigator.share!==void 0){let t=document.querySelector("#share");t.classList.remove("hidden"),t.addEventListener("click",async()=>{await navigator.share(e)})}}function changeTemperatureUnits(i){let e=i.target;highlightButtons(e);let l=document.querySelector(".temp-controls input:checked").value;document.querySelectorAll(".temperature").forEach(a=>{let n=Number(a.dataset.value);l=="F"&&(n=Math.round(n*1.8+32)),a.innerHTML=`<b>${n}</b>&deg;${l}`})}document.addEventListener("DOMContentLoaded",()=>{var i=document.querySelectorAll(".scale-controls input");for(const n of i)n.addEventListener("click",scaleRecipe);var e=document.querySelectorAll(".unit-controls input");for(const n of e)n.addEventListener("click",scaleRecipe);var t=document.querySelectorAll(".temp-controls input");for(const n of t)n.addEventListener("click",changeTemperatureUnits);var l=document.querySelectorAll(".substitute-btn");for(const n of l)n.addEventListener("click",o=>{o.target.closest("button").querySelector("span").classList.toggle("hidden")});customElements.define("timer-toast",TimerToast,{extends:"div"});var s=document.querySelectorAll(".toast-btn");for(const n of s)n.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let n=document.querySelector("#wakelock");n.closest("span").classList.remove("hidden"),n.addEventListener("click",toggleWakeLock)}document.querySelector("#show-amounts").classList.remove("hidden"),document.querySelector("#amounts").addEventListener("change",()=>{document.querySelectorAll(".tooltip").forEach(o=>{o.classList.toggle("visible")})}),setTheme(),enableShareButton()});
