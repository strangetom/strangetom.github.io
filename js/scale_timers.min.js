"use strict";const fractionMap={0:"","0.5":"\xBD","0.333":"\u2153","0.666":"\u2154","0.25":"\xBC","0.75":"\xBE","0.2":"\u2155","0.4":"\u2156","0.6":"\u2157","0.8":"\u2158","0.1665":"\u2159","0.833":"\u215A","0.14285":"\u2150","0.125":"\u215B","0.375":"\u215C","0.625":"\u215D","0.875":"\u215E"},convertableUnits={metric:{oz:[28,"g"],lb:[454,"g"],lbs:[454,"g"],pound:[454,"g"],pounds:[454,"g"],cup:[250,"ml"],cups:[250,"ml"],pint:[568,"ml"],pints:[568,"ml"],quart:[950,"nl"],quarts:[950,"nl"]},imperial:{g:[.035,"oz"],kg:[2.2,"lbs"],ml:[.00423,"cups"],l:[4.423,"cups"]}};var wakelock=null;class TimerToast extends HTMLDivElement{constructor(t,i){super(),this.time=document.createElement("span"),this.progress=document.createElement("div"),this.notificationEnabled=!1,this.notificationId=Date.now().toString(),this.counter=t,this.initial=t,this.displayTime(),this.time.classList.add("timer-text"),this.progress.classList.add("timer-progress"),this.progress.style.width="100%";const a=document.createElement("div");if(a.classList.add("timer-btns"),window.Notification&&Notification.permission!=="denied"){const n=document.createElement("img");n.src="../img/notification-disabled.svg",n.classList.add("timer-icon"),n.alt="Toggle timer notification";const c=document.createElement("button");c.classList.add("timer-btn"),c.addEventListener("click",()=>{this.notificationEnabled?(n.src="../img/notification-disabled.svg",this.notificationEnabled=!1):Notification.permission==="default"?Notification.requestPermission().then(u=>{u==="granted"&&(n.src="../img/notification.svg",this.notificationEnabled=!0)}):(n.src="../img/notification.svg",this.notificationEnabled=!0)}),c.appendChild(n),a.appendChild(c)}const e=document.createElement("img");e.src="../img/timer-start.svg",e.classList.add("timer-icon"),e.alt="Start timer";const l=document.createElement("button");l.classList.add("timer-btn"),l.addEventListener("click",()=>{this.interval==null?(this.interval=setInterval(this.decrement.bind(this),1e3),e.src="../img/timer-reset.svg"):(this.reset(),e.src="../img/timer-start.svg")}),l.appendChild(e),a.appendChild(l);const o=document.createElement("img");o.src="../img/timer-close.svg",o.classList.add("timer-icon"),o.alt="Delete timer";const r=document.createElement("button");if(r.classList.add("timer-btn"),r.addEventListener("click",()=>{this.closeNotification(),this.classList.add("toast-delete"),this.addEventListener("animationend",()=>{this.parentNode.removeChild(this)})}),r.appendChild(o),a.appendChild(r),this.appendChild(this.time),i!=""){let n=document.createElement("span");n.innerText=i.replace("@",""),n.classList.add("timer-text"),this.appendChild(n)}this.appendChild(this.progress),this.appendChild(a),this.classList.add("timer")}displayTime(){let t=Math.floor(this.counter/3600),i=Math.floor(this.counter%3600/60),a=Math.floor(this.counter%60),e=t<10?"0"+t:t.toString(),l=i<10?"0"+i:i.toString(),o=a<10?"0"+a:a.toString();this.time.textContent=e+":"+l+":"+o}decrement(){this.counter>0?(this.counter--,this.displayTime(),this.progress.style.width=(100*this.counter/this.initial).toFixed(2)+"%"):(this.classList.add("timer-expired"),clearInterval(this.interval),this.notificationEnabled&&Notification.permission==="granted"&&navigator.serviceWorker.ready.then(t=>{let i="/favicon.svg",a="/img/logo.svg",e="Timer expired!",l={url:window.location.href},o={body:e,icon:a,badge:i,data:l,tag:this.notificationId};t.showNotification("Stranger Foods",o)}))}reset(){this.interval!=null&&(clearInterval(this.interval),this.interval=null),this.closeNotification(),this.classList.remove("timer-expired"),this.counter=this.initial,this.progress.style.width="100%",this.displayTime()}closeNotification(){navigator.serviceWorker.ready.then(t=>{t.getNotifications({tag:this.notificationId}).then(i=>{for(const a of i)a.close()})})}}function scaleRecipe(s){let t=s.target;highlightButtons(t);let i=document.querySelector(".scale-btns > .selected"),a=Number(i.innerHTML.substring(1));i=document.querySelector(".unit-btns > .selected");let e=i.innerHTML.toLowerCase();setServings(a);let l=document.querySelectorAll(".scalable");for(var o=0;o<l.length;o++){let r=a,n=l[o];if(n.hasAttribute("data-unit")){if(n.dataset.default=="")continue;let c=n.dataset.defaultunit,u=n.dataset.default.slice(-1)=="x";if(Object.keys(convertableUnits[e]).includes(c)){let d=convertableUnits[e][c];r*=d[0],n.dataset.unit=d[1]}else u?n.dataset.unit=convertMixedUnit(e,c):n.dataset.unit=n.dataset.defaultunit;let m;if(n.dataset.default.includes("-"))m=scaleRange(n.dataset.default,r);else if(u){let d=Number(n.dataset.default.slice(0,-1));m=formatQuantity(d*r)}else{let d=Number(n.dataset.default);m=formatQuantity(d*r)}setScaledValue(n,m,u)}else{let c=n.nextElementSibling,u=c.dataset.unit;if(Object.keys(convertableUnits[e]).includes(u)){let d=convertableUnits[e][u];r*=d[0],c.innerHTML=d[1]}else c.innerHTML=convertMixedUnit(e,u);let m;if(n.dataset.default.includes("-")){let d=n.dataset.default;m=scaleRange(n.dataset.default,r)}else{let d=Number(n.dataset.default);m=formatQuantity(d*r)}setScaledValue(n,m,!1)}}}function setServings(s){let t=document.getElementById("servings"),i=t.dataset.default;i.includes("-")?t.innerHTML=scaleRange(i,s):t.innerHTML=formatQuantity(Number(i)*s)}function highlightButtons(s){let t=s.parentElement.children;for(const i of t)i.classList.remove("selected");s.classList.add("selected")}function convertMixedUnit(s,t){let i=Object.keys(convertableUnits[s]).join("|"),e=new RegExp("(?<quantity>\\d+)\\s(?<unit>"+i+")(?<extra>.*)","g").exec(t);if(e){let l=convertableUnits[s][e.groups.unit];return formatQuantity(Number(e.groups.quantity)*l[0])+" "+l[1]+e.groups.extra}else return t}function setScaledValue(s,t,i){i&&(t+="x"),"quantity"in s.dataset?s.dataset.quantity=t:s.innerHTML=t}function scaleRange(s,t){let i=s.split("-"),a=Number(i[0])*t,e=Number(i[1])*t;return formatQuantity(a)+"-"+formatQuantity(e)}function formatQuantity(s){if(Number.isInteger(Number(s)))return s.toString();let t=Math.floor(s),i=Number(s%1),e=Object.keys(fractionMap).map(Number).reduce(function(o,r){return Math.abs(r-i)<Math.abs(o-i)?r:o}),l=fractionMap[e];return t==0?l:t.toString()+l}function toggleSubtitutions(s){let t=s.target,i=t.parentElement.querySelector(".substitute-text");i.classList.toggle("hidden"),i.classList.contains("hidden")?t.src="../img/cart-fill.svg":t.src="../img/cart.svg"}function addTimerToast(){let s=Number(this.dataset.time),t=this.dataset.label;document.querySelector("#timers").appendChild(new TimerToast(s,t))}async function toggleWakeLock(){if(wakelock==null)try{wakelock=await navigator.wakeLock.request("screen")}catch(s){console.log(`Wakelock failed: ${s.message}`)}else wakelock.release().then(()=>wakelock=null)}document.addEventListener("DOMContentLoaded",()=>{var s=document.querySelectorAll(".scale-btns > button");for(const e of s)e.addEventListener("click",scaleRecipe);var t=document.querySelectorAll(".unit-btns > button");for(const e of t)e.addEventListener("click",scaleRecipe);var i=document.querySelectorAll(".substitute-icon");for(const e of i)e.addEventListener("click",toggleSubtitutions);customElements.define("timer-toast",TimerToast,{extends:"div"});var a=document.querySelectorAll(".toast-btn");for(const e of a)e.addEventListener("click",addTimerToast);if("wakeLock"in navigator){let e=document.querySelector("#wakelock");e.parentElement.classList.remove("hidden"),e.addEventListener("change",toggleWakeLock)}});
