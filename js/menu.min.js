"use strict";document.addEventListener("DOMContentLoaded",()=>{installServiceWorker();let e=document.querySelector("button#sidebar"),n=document.querySelector("nav"),t=document.querySelector("main");e.addEventListener("click",s=>{n.style.transform===""||n.style.transform==="translateX(0px)"?(n.style.transform="translateX(-250px)",t.style.transform="translateX(-250px)"):(n.style.transform="translateX(0px)",t.style.transform="translateX(0px)")}),updateCacheButton();let l=document.querySelector("#cache-site-btn");l?.addEventListener("click",()=>{cacheSite(recipe_data.recipes)});let a=document.querySelector("#theme-btn");a.disabled=!1,a.addEventListener("click",toggleTheme);let r=localStorage.getItem("light-theme");r==null?applyTheme("Auto"):r=="true"?applyTheme("Light"):applyTheme("Dark")});function installServiceWorker(){"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/service-worker.min.js").then(function(){console.log("CLIENT: service worker registration complete.")},function(){console.log("CLIENT: service worker registration failure.")})):console.log("CLIENT: service worker is not supported.")}var CacheStatus=(l=>(l[l.None=0]="None",l[l.Update=1]="Update",l[l.Current=2]="Current",l))(CacheStatus||{});function checkOfflineCacheStatus(){let e=localStorage.getItem("last-update-hash");return e==null?0:document.querySelector("meta[name='update-hash']").content!=e?1:2}function cacheSite(e){let n=e.map(t=>[`/recipes/${t.slug}`,`/images/${t.slug}.webp`]).flat();n.push("/js/search_data.min.js"),n.push("/all-recipes"),n.push("/top-recipes"),caches.keys().then(t=>t[t.length-1]).then(t=>{caches.open(t).then(l=>{l.addAll(n)})}).then(()=>{let t=document.querySelector("meta[name='update-hash']");localStorage.setItem("last-update-hash",t.content),updateCacheButton()})}async function updateCacheButton(){let e=document.querySelector("#cache-site-btn");if(e==null)return;let t=(await navigator.storage.estimate()).quota,l=Number(document.querySelector("meta[name='cache-size']").content);if(l>t)return;let a=Math.ceil(l/1e6).toString(),r=checkOfflineCacheStatus();r==0?(e.innerHTML=`Cache site<span class="light-text">${a} MB</span>`,e.disabled=!1):r==1?(e.innerHTML=`Download<span class="light-text">${a} MB</span>`,e.disabled=!1):(e.innerHTML="Available offline",e.disabled=!0)}function toggleTheme(){let e=document.querySelector("#theme-btn .light-text");e.innerText=="Auto"?applyTheme("Dark"):e.innerText=="Dark"?applyTheme("Light"):e.innerText=="Light"&&applyTheme("Auto")}function applyTheme(e){let n=document.querySelector("html"),t=document.querySelector("#theme-btn .light-text");e=="Dark"?(localStorage.setItem("light-theme","false"),n.classList.remove("light-theme"),t.innerText="Dark"):e=="Light"?(localStorage.setItem("light-theme","true"),n.classList.add("light-theme"),t.innerText="Light"):e=="Auto"&&applyAutoTheme()}function applyAutoTheme(){let e=document.querySelector("html"),n=document.querySelector("#theme-btn .light-text");n.innerText="Auto",window.matchMedia("(prefers-color-scheme: light)").matches?(localStorage.removeItem("light-theme"),e.classList.add("light-theme")):(localStorage.removeItem("light-theme"),e.classList.remove("light-theme"))}
